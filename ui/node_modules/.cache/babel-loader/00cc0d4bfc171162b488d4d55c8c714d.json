{"ast":null,"code":"const mongoose = require(\"mongoose\");\n\nconst cuid = require(\"cuid\");\n/*const addGcalEvent = require('./../googleCalendar')*/\n\n\nconst setHours = require(\"date-fns/setHours\");\n\nconst addressObj = {\n  _id: {\n    type: String,\n    default: cuid\n  },\n  value: {\n    type: String\n  }\n};\nconst addressSchema = new mongoose.Schema(addressObj);\nconst operativesObj = {\n  _id: {\n    type: String,\n    default: cuid\n  },\n  value: {\n    type: String\n  }\n};\nconst operativesSchema = new mongoose.Schema(oper);\nconst chargesObject = {\n  hourlyRate: {\n    type: Number\n  },\n  fuelCharge: {\n    type: Number\n  },\n  travelTime: {\n    type: Number\n  }\n};\nconst chargesSchema = new mongoose.Schema(chargesObject);\nconst jobSchema = new mongoose.Schema({\n  _id: {\n    type: String,\n    default: cuid\n  },\n  start: {\n    type: Date,\n    required: true\n  },\n  end: {\n    type: Date,\n    required: true\n  },\n  customer: {\n    name: {\n      type: String,\n      validate: {\n        validator: v => {\n          console.log(\"v\", v);\n          return v.length > 4;\n        },\n        message: `name must have more than 4 characters`\n      }\n    },\n    mobile: {\n      type: String\n    },\n    email: {\n      type: String\n    }\n  },\n  charges: chargesSchema,\n  operatives: [operativesSchema],\n  items: String,\n  addresses: [addressSchema]\n});\n\nfunction buildJobSchema(mongoose, addressObj, operativesObj, chargesObj, jobObj) {}\n\nlet Job = mongoose.model(\"Job\", jobSchema, \"jobs\");\n\nasync function list({\n  from,\n  to\n}) {\n  let data = await Job.find({\n    start: {\n      $gte: from\n    },\n    end: {\n      $lte: to\n    }\n  });\n  return data;\n}\n\nasync function create(data) {\n  let job = new Job(data);\n  await job.save(); //TODO add some validation start must be before end\n\n  return job;\n}\n\nasync function get(id) {\n  const job = await Job.findById(id);\n  return job;\n}\n\nasync function remove(id) {\n  let data = await Job.deleteOne({\n    _id: id\n  });\n  return data;\n}\n\nasync function edit(_id, change) {\n  const product = await get(_id);\n  Object.keys(change).forEach(function (key) {\n    product[key] = change[key];\n  });\n  await product.save();\n  return product;\n}\n\nasync function resetData(data) {\n  await Job.deleteMany();\n  console.log(data);\n  await Job.insertMany(data);\n}\n\nmodule.exports = {\n  list,\n  create,\n  get,\n  remove,\n  resetData,\n  edit,\n  jobSchema\n};\nexports.Job = Job;","map":{"version":3,"sources":["/home/gregorian/calendar-ui/api/model/job.js"],"names":["mongoose","require","cuid","setHours","addressObj","_id","type","String","default","value","addressSchema","Schema","operativesObj","operativesSchema","oper","chargesObject","hourlyRate","Number","fuelCharge","travelTime","chargesSchema","jobSchema","start","Date","required","end","customer","name","validate","validator","v","console","log","length","message","mobile","email","charges","operatives","items","addresses","buildJobSchema","chargesObj","jobObj","Job","model","list","from","to","data","find","$gte","$lte","create","job","save","get","id","findById","remove","deleteOne","edit","change","product","Object","keys","forEach","key","resetData","deleteMany","insertMany","module","exports"],"mappings":"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","sourcesContent":["const mongoose = require(\"mongoose\");\nconst cuid = require(\"cuid\");\n/*const addGcalEvent = require('./../googleCalendar')*/\n\nconst setHours = require(\"date-fns/setHours\");\n\nconst addressObj = {\n  _id: {\n    type: String,\n    default: cuid,\n  },\n  value: {\n    type: String,\n  },\n}\n\nconst addressSchema = new mongoose.Schema(addressObj);\n\nconst operativesObj = {\n  _id: {\n    type: String,\n    default: cuid,\n  },\n  value: {\n    type: String,\n  },\n}\n\nconst operativesSchema = new mongoose.Schema(oper);\n\nconst chargesObject = {\n  hourlyRate: { type: Number },\n  fuelCharge: { type: Number },\n  travelTime: { type: Number },\n}\n\nconst chargesSchema = new mongoose.Schema(chargesObject);\n\nconst jobSchema = new mongoose.Schema({\n  _id: {\n    type: String,\n    default: cuid,\n  },\n  start: {\n    type: Date,\n    required: true,\n  },\n  end: {\n    type: Date,\n    required: true,\n  },\n  customer: {\n    name: {\n      type: String,\n      validate: {\n        validator: (v) => {\n          console.log(\"v\", v);\n          return v.length > 4;\n        },\n        message: `name must have more than 4 characters`,\n      },\n    },\n    mobile: { type: String },\n    email: { type: String },\n  },\n  charges: chargesSchema,\n  operatives: [operativesSchema],\n  items: String,\n  addresses: [addressSchema],\n});\n\nfunction buildJobSchema(mongoose,addressObj,operativesObj,chargesObj,jobObj,){\n\n}\n\nlet Job = mongoose.model(\"Job\", jobSchema, \"jobs\");\n\nasync function list({ from, to }) {\n  let data = await Job.find({\n    start: { $gte: from },\n    end: { $lte: to },\n  });\n  return data;\n}\n\nasync function create(data) {\n  let job = new Job(data);\n  await job.save(); //TODO add some validation start must be before end\n  return job;\n}\n\nasync function get(id) {\n  const job = await Job.findById(id);\n  return job;\n}\n\nasync function remove(id) {\n  let data = await Job.deleteOne({ _id: id });\n  return data;\n}\n\nasync function edit(_id, change) {\n  const product = await get(_id);\n  Object.keys(change).forEach(function (key) {\n    product[key] = change[key];\n  });\n  await product.save();\n  return product;\n}\n\nasync function resetData(data) {\n  await Job.deleteMany();\n  console.log(data);\n  await Job.insertMany(data);\n}\n\nmodule.exports = {\n  list,\n  create,\n  get,\n  remove,\n  resetData,\n  edit,\n  jobSchema,\n};\n\nexports.Job = Job;\n"]},"metadata":{},"sourceType":"script"}