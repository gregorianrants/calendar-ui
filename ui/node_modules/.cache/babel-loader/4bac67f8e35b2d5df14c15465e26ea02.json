{"ast":null,"code":"import _toConsumableArray from\"/home/gregorian/calendar-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/gregorian/calendar-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/home/gregorian/calendar-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import styled from\"styled-components\";import NewJobModal from\"../forms/NewJobModal\";import DayLabels from\"../DayLabels\";import Week from\"../Week\";import HourTicks from\"../HourTicks\";import Header from\"../Header\";import settingsContext from\"../Contexts\";import{fetchDays}from\"../../Model/Jobs\";import React from\"react\";import{fitsInWeek}from\"../../utilities/dateUtilities.js\";import JobModal from\"../forms/JobModal\";//import socketIOClient from \"socket.io-client\";\nimport{useWeek}from\"./reducer\";import{useGapi}from\"../../useGapi/useGapi\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CalendarStyled=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin: 30px;\\n  display: grid;\\n  grid-template-rows: 60px 60px \",\";\\n  grid-template-columns: 60px 1fr;\\n\"])),function(props){return String(props.hourHeight*24)+\"px\";});export default function Calendar(){var _useWeek=useWeek(),_useWeek2=_slicedToArray(_useWeek,2),daysOnCal=_useWeek2[0],dispatch=_useWeek2[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),showNewJobModal=_React$useState2[0],setShowNewJobModal=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),displayEvent=_React$useState4[0],setDisplayEvent=_React$useState4[1];var _React$useState5=React.useState([]),_React$useState6=_slicedToArray(_React$useState5,2),events=_React$useState6[0],setEvents=_React$useState6[1];var _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),gcalEvents=_React$useState8[0],setGcalEvents=_React$useState8[1];//TODO have a think about what you are using/nameing current day. what does that mean\n//useGapi also returns a sign out function\nvar _useGapi=useGapi(),authed=_useGapi.authed,listEvents=_useGapi.listEvents;var _React$useContext=React.useContext(settingsContext),hourHeight=_React$useContext.hourHeight;var updateDisplayEvent=function updateDisplayEvent(id){setDisplayEvent(events.filter(function(event){return event._id===id;})[0]);};React.useEffect(function(){fetchDays(daysOnCal.firstDay,daysOnCal.lastDay).then(function(data){setEvents(_toConsumableArray(data));//TODO have a look at what we are doing here what if there is no data\n}).catch(console.error);},[daysOnCal]);React.useEffect(function(){if(authed){listEvents(daysOnCal.firstDay,daysOnCal.lastDay)//TODO should technically be a dependancy need to wrap it in useCallback\n.then(setGcalEvents);console.log(\"aggghhhh\");}},[authed,daysOnCal]);//added in the listEvebts due to a warning in conslol\n/*  React.useEffect(()=>{\n        const socket = socketIOClient('http://localhost:8000');\n        console.log(socket)\n\n        socket.on('message',(msg)=>{\n            fetchWeekContaining(firstDayOfWeek)\n                .then(data=> {\n                    setEvents(data)\n                })\n                .catch(console.error)\n        })\n    },[firstDayOfWeek])*/var incrementWeek=function incrementWeek(){dispatch({type:\"INCREMENT\"});};var decrementWeek=function decrementWeek(){dispatch({type:\"DECREMENT\"});};var toggleNewJobModal=function toggleNewJobModal(){setShowNewJobModal(function(val){return!val;});};var closeDetailsModal=function closeDetailsModal(){setDisplayEvent(null);};var addToEvents=function addToEvents(event){if(fitsInWeek(daysOnCal.firstDay,event.start)){setEvents(function(events){return[].concat(_toConsumableArray(events),[event]);});}};var updateEvent=function updateEvent(id,data){console.log(data);setEvents(function(events){var remainder=events.filter(function(event){return event._id!==id;});var result=[].concat(_toConsumableArray(remainder),[data]);return result;});};return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(CalendarStyled,{hourHeight:hourHeight,children:[/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(Header,{currentDate:daysOnCal.currentDate,incrementWeek:incrementWeek,decrementWeek:decrementWeek,handleShowModal:toggleNewJobModal}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(DayLabels,{days:daysOnCal.days}),/*#__PURE__*/_jsx(HourTicks,{}),/*#__PURE__*/_jsx(Week,{events:events,gcalEvents:gcalEvents,days:daysOnCal.days,updateDisplayEvent:updateDisplayEvent,updateEvent:updateEvent})]}),showNewJobModal&&/*#__PURE__*/_jsx(NewJobModal,{addToEvents:addToEvents,toggleModal:toggleNewJobModal}),displayEvent&&/*#__PURE__*/_jsx(JobModal,{displayEvent:displayEvent,close:closeDetailsModal,updateEvent:updateEvent})]});}","map":{"version":3,"sources":["/home/gregorian/calendar-ui/ui/src/components/Calendar/Calendar.js"],"names":["styled","NewJobModal","DayLabels","Week","HourTicks","Header","settingsContext","fetchDays","React","fitsInWeek","JobModal","useWeek","useGapi","CalendarStyled","div","props","String","hourHeight","Calendar","daysOnCal","dispatch","useState","showNewJobModal","setShowNewJobModal","displayEvent","setDisplayEvent","events","setEvents","gcalEvents","setGcalEvents","authed","listEvents","useContext","updateDisplayEvent","id","filter","event","_id","useEffect","firstDay","lastDay","then","data","catch","console","error","log","incrementWeek","type","decrementWeek","toggleNewJobModal","val","closeDetailsModal","addToEvents","start","updateEvent","remainder","result","currentDate","days"],"mappings":"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","sourcesContent":["import styled from \"styled-components\";\nimport NewJobModal from \"../forms/NewJobModal\";\n\nimport DayLabels from \"../DayLabels\";\nimport Week from \"../Week\";\nimport HourTicks from \"../HourTicks\";\n\nimport Header from \"../Header\";\nimport settingsContext from \"../Contexts\";\n\nimport { fetchDays } from \"../../Model/Jobs\";\n\nimport React from \"react\";\nimport { fitsInWeek } from \"../../utilities/dateUtilities.js\";\n\nimport JobModal from \"../forms/JobModal\";\n\n//import socketIOClient from \"socket.io-client\";\n\nimport { useWeek } from \"./reducer\";\nimport { useGapi } from \"../../useGapi/useGapi\";\n\nconst CalendarStyled = styled.div`\n  margin: 30px;\n  display: grid;\n  grid-template-rows: 60px 60px ${(props) =>\n      String(props.hourHeight * 24) + \"px\"};\n  grid-template-columns: 60px 1fr;\n`;\n\nexport default function Calendar() {\n  const [daysOnCal, dispatch] = useWeek();\n  const [showNewJobModal, setShowNewJobModal] = React.useState(false);\n  const [displayEvent, setDisplayEvent] = React.useState(null);\n  const [events, setEvents] = React.useState([]);\n  const [gcalEvents, setGcalEvents] = React.useState([]);\n  //TODO have a think about what you are using/nameing current day. what does that mean\n\n  //useGapi also returns a sign out function\n  const { authed, listEvents } = useGapi();\n\n  const { hourHeight } = React.useContext(settingsContext);\n\n  const updateDisplayEvent = (id) => {\n    setDisplayEvent(events.filter((event) => event._id === id)[0]);\n  };\n\n  React.useEffect(() => {\n    fetchDays(daysOnCal.firstDay, daysOnCal.lastDay)\n      .then((data) => {\n        setEvents([...data]); //TODO have a look at what we are doing here what if there is no data\n      })\n      .catch(console.error);\n  }, [daysOnCal]);\n\n  React.useEffect(() => {\n    if (authed) {\n      listEvents(daysOnCal.firstDay, daysOnCal.lastDay) //TODO should technically be a dependancy need to wrap it in useCallback\n        .then(setGcalEvents);\n\n      console.log(\"aggghhhh\");\n    }\n  }, [authed, daysOnCal]); //added in the listEvebts due to a warning in conslol\n\n  /*  React.useEffect(()=>{\n        const socket = socketIOClient('http://localhost:8000');\n        console.log(socket)\n\n        socket.on('message',(msg)=>{\n            fetchWeekContaining(firstDayOfWeek)\n                .then(data=> {\n                    setEvents(data)\n                })\n                .catch(console.error)\n        })\n    },[firstDayOfWeek])*/\n\n  const incrementWeek = () => {\n    dispatch({ type: \"INCREMENT\" });\n  };\n\n  const decrementWeek = () => {\n    dispatch({ type: \"DECREMENT\" });\n  };\n\n  const toggleNewJobModal = () => {\n    setShowNewJobModal((val) => !val);\n  };\n\n  const closeDetailsModal = () => {\n    setDisplayEvent(null);\n  };\n\n  const addToEvents = (event) => {\n    if (fitsInWeek(daysOnCal.firstDay, event.start)) {\n      setEvents((events) => [...events, event]);\n    }\n  };\n\n  const updateEvent = (id, data) => {\n    console.log(data);\n    setEvents((events) => {\n    \n      const remainder = events.filter((event) => event._id !== id);\n     \n      const result = [...remainder, data];\n     \n      return result;\n    });\n  };\n\n  return (\n    <React.Fragment>\n      <CalendarStyled hourHeight={hourHeight}>\n        <div></div>\n        <Header\n          currentDate={daysOnCal.currentDate}\n          incrementWeek={incrementWeek}\n          decrementWeek={decrementWeek}\n          handleShowModal={toggleNewJobModal}\n        />\n        <div></div>\n        <DayLabels days={daysOnCal.days} />\n        <HourTicks />\n        <Week\n          events={events}\n          gcalEvents={gcalEvents}\n          days={daysOnCal.days}\n          updateDisplayEvent={updateDisplayEvent}\n          updateEvent={updateEvent}\n        />\n      </CalendarStyled>\n      {showNewJobModal && (\n        <NewJobModal\n          addToEvents={addToEvents}\n          toggleModal={toggleNewJobModal}\n        />\n      )}\n      {displayEvent && (\n        <JobModal\n          displayEvent={displayEvent}\n          close={closeDetailsModal}\n          updateEvent={updateEvent}\n        />\n      )}\n    </React.Fragment>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}