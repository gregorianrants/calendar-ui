{"ast":null,"code":"const {\n  cloneDeep\n} = require(\"lodash\");\n\nconst {\n  pipe,\n  partialRight,\n  curry,\n  flip\n} = require(\"ramda\");\n\nfunction removeDotPaths(obj) {\n  return Object.keys(obj).reduce((a, b) => {\n    if (b.includes(\".\")) {\n      return a;\n    } else {\n      return { ...a,\n        [b]: cloneDeep(obj[b])\n      };\n    }\n  }, {});\n}\n\nfunction isValidatorError(obj) {\n  if (!typeof obj === \"object\") return false;\n\n  if (obj.hasOwnProperty(\"name\") && obj[\"name\"] === \"ValidatorError\") {\n    return true;\n  }\n\n  return false;\n}\n\nfunction handleValidatorError(obj) {\n  return obj.message;\n}\n\nfunction isCastError(obj) {\n  console.log(\"hello\");\n  if (!typeof obj === \"object\") return false;\n\n  if (obj.hasOwnProperty(\"name\") && obj[\"name\"] === \"CastError\") {\n    return true;\n  }\n\n  return false;\n}\n\nfunction handleCastError(obj) {\n  return `${obj.path} should be a ${obj.Kind}`;\n} //TO UNDERSTAND LOOK AT THIS FIRST THE FURHTER CHANGES ARE JUST TO MAKE IMMUTABLE AND FUNCTIONAL - this is a recursive function\n// i realise this is pretty confusing but so are mongoose error objects\n//\n// function process(errorsObj, result) {\n//   if (errorsObj.hasOwnProperty(\"errors\"))\n//     return process(errorsObj[\"errors\"], result);\n//   if (errorsObj.hasOwnProperty(\"properties\"))\n//     return errorsObj[\"properties\"][\"message\"];\n//   let builder = {};\n//   for (const [key, value] of Object.entries(errorsObj)) {\n//     builder[key] = process(value, {});\n//   }\n//   return builder;\n// }\n//we wrap the function purely to clone the errors obj passed to it,\n//because passing oject by reference can cause bugs, this could happen if we modified the object,\n//we dont modify it but i have cloned it anyway so that the object passed is forever protected from modification by this function.\n\n\nfunction asNormalObj(err) {\n  return err ? JSON.parse(JSON.stringify(err)) : null;\n}\n\nfunction processMongooseError(errorsObj) {\n  if (!errorsObj) return null;\n  const pretty = JSON.stringify(errorsObj || {}, null, 2);\n  console.log(pretty);\n\n  function inner(errorsObj, result) {\n    if (errorsObj.hasOwnProperty(\"errors\")) return inner(errorsObj[\"errors\"]);\n    if (isCastError(errorsObj)) return handleCastError(errorsObj);\n    if (isValidatorError(errorsObj)) return handleValidatorError(errorsObj);\n    let builder = {};\n    const withoutDuplicates = removeDotPaths(errorsObj); //todo proccess the object outside of function to remove all dot paths first\n\n    for (const [key, value] of Object.entries(withoutDuplicates)) {\n      builder[key] = inner(value);\n    }\n\n    return builder;\n  }\n\n  return inner(asNormalObj());\n}\n\nmodule.exports = processMongooseError;\nconst CastError = {\n  errors: {\n    \"charges.hourlyRate\": {\n      stringValue: '\"b\"',\n      valueType: \"string\",\n      kind: \"Number\",\n      value: \"b\",\n      path: \"hourlyRate\",\n      reason: {\n        name: \"AssertionError\",\n        actual: false,\n        expected: true,\n        operator: \"==\",\n        message: \"false == true\",\n        generatedMessage: true\n      },\n      name: \"CastError\",\n      message: 'Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"'\n    },\n    charges: {\n      errors: {\n        hourlyRate: {\n          stringValue: '\"b\"',\n          valueType: \"string\",\n          kind: \"Number\",\n          value: \"b\",\n          path: \"hourlyRate\",\n          reason: {\n            name: \"AssertionError\",\n            actual: false,\n            expected: true,\n            operator: \"==\",\n            message: \"false == true\",\n            generatedMessage: true\n          },\n          name: \"CastError\",\n          message: 'Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"'\n        }\n      },\n      _message: \"Validation failed\",\n      name: \"ValidationError\",\n      message: 'Validation failed: hourlyRate: Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"'\n    }\n  },\n  _message: \"Validation failed\",\n  name: \"ValidationError\",\n  message: 'Validation failed: charges.hourlyRate: Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\", charges: Validation failed: hourlyRate: Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"'\n};\nconst errorsObj = {\n  errors: {\n    customer: {\n      errors: {\n        name: {\n          name: \"ValidatorError\",\n          message: \"name must have more than 4 characters\",\n          properties: {\n            message: \"name must have more than 4 characters\",\n            type: \"user defined\",\n            path: \"name\",\n            value: \"Al\"\n          },\n          kind: \"user defined\",\n          path: \"name\",\n          value: \"Al\"\n        }\n      },\n      _message: \"Validation failed\",\n      name: \"ValidationError\",\n      message: \"Validation failed: name: name must have more than 4 characters\"\n    },\n    operatives: {\n      errors: {\n        value: {\n          name: \"ValidatorError\",\n          message: \"name must have more than 4 characters\",\n          properties: {\n            message: \"name must have more than 4 characters\",\n            type: \"user defined\",\n            path: \"value\",\n            value: \"dave\"\n          },\n          kind: \"user defined\",\n          path: \"value\",\n          value: \"dave\"\n        }\n      },\n      _message: \"Validation failed\",\n      name: \"ValidationError\",\n      message: \"Validation failed: value: name must have more than 4 characters\"\n    }\n  },\n  _message: \"Validation failed\",\n  name: \"ValidationError\",\n  message: \"Validation failed: customer.name: name must have more than 4 characters, customer: Validation failed: name: name must have more than 4 characters, operatives: Validation failed: value: name must have more than 4 characters\"\n};\nlet res = processMongooseError(errorsObj);\nconsole.log(res);","map":{"version":3,"sources":["/home/gregorian/calendar-ui/ui/src/utilities/processMongooseError.js"],"names":["cloneDeep","require","pipe","partialRight","curry","flip","removeDotPaths","obj","Object","keys","reduce","a","b","includes","isValidatorError","hasOwnProperty","handleValidatorError","message","isCastError","console","log","handleCastError","path","Kind","asNormalObj","err","JSON","parse","stringify","processMongooseError","errorsObj","pretty","inner","result","builder","withoutDuplicates","key","value","entries","module","exports","CastError","errors","stringValue","valueType","kind","reason","name","actual","expected","operator","generatedMessage","charges","hourlyRate","_message","customer","properties","type","operatives","res"],"mappings":"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","sourcesContent":["const { cloneDeep } = require(\"lodash\");\nconst { pipe, partialRight, curry, flip } = require(\"ramda\");\n\nfunction removeDotPaths(obj) {\n  return Object.keys(obj).reduce((a, b) => {\n    if (b.includes(\".\")) {\n      return a;\n    } else {\n      return { ...a, [b]: cloneDeep(obj[b]) };\n    }\n  }, {});\n}\n\nfunction isValidatorError(obj) {\n  if (!typeof obj === \"object\") return false;\n\n  if (obj.hasOwnProperty(\"name\") && obj[\"name\"] === \"ValidatorError\") {\n    return true;\n  }\n  return false;\n}\n\nfunction handleValidatorError(obj) {\n  return obj.message;\n}\n\nfunction isCastError(obj) {\n  console.log(\"hello\");\n  if (!typeof obj === \"object\") return false;\n\n  if (obj.hasOwnProperty(\"name\") && obj[\"name\"] === \"CastError\") {\n    return true;\n  }\n  return false;\n}\n\nfunction handleCastError(obj) {\n  return `${obj.path} should be a ${obj.Kind}`;\n}\n\n//TO UNDERSTAND LOOK AT THIS FIRST THE FURHTER CHANGES ARE JUST TO MAKE IMMUTABLE AND FUNCTIONAL - this is a recursive function\n// i realise this is pretty confusing but so are mongoose error objects\n//\n// function process(errorsObj, result) {\n//   if (errorsObj.hasOwnProperty(\"errors\"))\n//     return process(errorsObj[\"errors\"], result);\n\n//   if (errorsObj.hasOwnProperty(\"properties\"))\n//     return errorsObj[\"properties\"][\"message\"];\n\n//   let builder = {};\n//   for (const [key, value] of Object.entries(errorsObj)) {\n//     builder[key] = process(value, {});\n//   }\n//   return builder;\n// }\n\n//we wrap the function purely to clone the errors obj passed to it,\n//because passing oject by reference can cause bugs, this could happen if we modified the object,\n//we dont modify it but i have cloned it anyway so that the object passed is forever protected from modification by this function.\n\nfunction asNormalObj(err) {\n  return err ? JSON.parse(JSON.stringify(err)) : null;\n}\n\nfunction processMongooseError(errorsObj) {\n  if (!errorsObj) return null;\n  const pretty = JSON.stringify(errorsObj || {}, null, 2);\n  console.log(pretty);\n  function inner(errorsObj, result) {\n    if (errorsObj.hasOwnProperty(\"errors\")) return inner(errorsObj[\"errors\"]);\n\n    if (isCastError(errorsObj)) return handleCastError(errorsObj);\n    if (isValidatorError(errorsObj)) return handleValidatorError(errorsObj);\n\n    let builder = {};\n    const withoutDuplicates = removeDotPaths(errorsObj); //todo proccess the object outside of function to remove all dot paths first\n    for (const [key, value] of Object.entries(withoutDuplicates)) {\n      builder[key] = inner(value);\n    }\n\n    return builder;\n  }\n  return inner(asNormalObj());\n}\n\nmodule.exports = processMongooseError;\n\nconst CastError = {\n  errors: {\n    \"charges.hourlyRate\": {\n      stringValue: '\"b\"',\n      valueType: \"string\",\n      kind: \"Number\",\n      value: \"b\",\n      path: \"hourlyRate\",\n      reason: {\n        name: \"AssertionError\",\n        actual: false,\n        expected: true,\n        operator: \"==\",\n        message: \"false == true\",\n        generatedMessage: true,\n      },\n      name: \"CastError\",\n      message:\n        'Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"',\n    },\n    charges: {\n      errors: {\n        hourlyRate: {\n          stringValue: '\"b\"',\n          valueType: \"string\",\n          kind: \"Number\",\n          value: \"b\",\n          path: \"hourlyRate\",\n          reason: {\n            name: \"AssertionError\",\n            actual: false,\n            expected: true,\n            operator: \"==\",\n            message: \"false == true\",\n            generatedMessage: true,\n          },\n          name: \"CastError\",\n          message:\n            'Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"',\n        },\n      },\n      _message: \"Validation failed\",\n      name: \"ValidationError\",\n      message:\n        'Validation failed: hourlyRate: Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"',\n    },\n  },\n  _message: \"Validation failed\",\n  name: \"ValidationError\",\n  message:\n    'Validation failed: charges.hourlyRate: Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\", charges: Validation failed: hourlyRate: Cast to Number failed for value \"b\" (type string) at path \"hourlyRate\"',\n};\n\nconst errorsObj = {\n  errors: {\n    customer: {\n      errors: {\n        name: {\n          name: \"ValidatorError\",\n          message: \"name must have more than 4 characters\",\n          properties: {\n            message: \"name must have more than 4 characters\",\n            type: \"user defined\",\n            path: \"name\",\n            value: \"Al\",\n          },\n          kind: \"user defined\",\n          path: \"name\",\n          value: \"Al\",\n        },\n      },\n      _message: \"Validation failed\",\n      name: \"ValidationError\",\n      message: \"Validation failed: name: name must have more than 4 characters\",\n    },\n    operatives: {\n      errors: {\n        value: {\n          name: \"ValidatorError\",\n          message: \"name must have more than 4 characters\",\n          properties: {\n            message: \"name must have more than 4 characters\",\n            type: \"user defined\",\n            path: \"value\",\n            value: \"dave\",\n          },\n          kind: \"user defined\",\n          path: \"value\",\n          value: \"dave\",\n        },\n      },\n      _message: \"Validation failed\",\n      name: \"ValidationError\",\n      message:\n        \"Validation failed: value: name must have more than 4 characters\",\n    },\n  },\n  _message: \"Validation failed\",\n  name: \"ValidationError\",\n  message:\n    \"Validation failed: customer.name: name must have more than 4 characters, customer: Validation failed: name: name must have more than 4 characters, operatives: Validation failed: value: name must have more than 4 characters\",\n};\n\nlet res = processMongooseError(errorsObj);\n\nconsole.log(res);\n"]},"metadata":{},"sourceType":"module"}