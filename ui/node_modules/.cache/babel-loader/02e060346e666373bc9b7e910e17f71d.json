{"ast":null,"code":"const mongoose = require(\"mongoose\");\n\nconst cuid = require(\"cuid\");\n/*const addGcalEvent = require('./../googleCalendar')*/\n\n\nconst setHours = require(\"date-fns/setHours\");\n\nfunction buildSchema(mongoose) {\n  const addressSchema = new mongoose.Schema({\n    _id: {\n      type: String,\n      default: cuid\n    },\n    value: {\n      type: String\n    }\n  });\n  const operativesSchema = new mongoose.Schema({\n    _id: {\n      type: String,\n      default: cuid\n    },\n    value: {\n      type: String\n    }\n  });\n  const chargesSchema = new mongoose.Schema({\n    hourlyRate: {\n      type: Number\n    },\n    fuelCharge: {\n      type: Number\n    },\n    travelTime: {\n      type: Number\n    }\n  });\n  const jobSchema = new mongoose.Schema({\n    _id: {\n      type: String,\n      default: cuid\n    },\n    start: {\n      type: Date,\n      required: true\n    },\n    end: {\n      type: Date,\n      required: true\n    },\n    customer: {\n      name: {\n        type: String,\n        validate: [{\n          validator: v => {\n            return v.length > 4;\n          },\n          message: `name must have more than 4 characters`\n        } // this validator was used to look at how multiple validators are handled\n        // \n        // {\n        //   validator: (v) => {\n        //     return v[0] === \"A\";\n        //   },\n        //   message: `first letter must be A`,\n        // },\n        ]\n      },\n      mobile: {\n        type: String\n      },\n      email: {\n        type: String\n      }\n    },\n    charges: chargesSchema,\n    operatives: [operativesSchema],\n    items: String,\n    addresses: [addressSchema]\n  });\n  return jobSchema;\n}\n\nconst jobSchema = buildSchema(mongoose);\nlet Job = mongoose.model(\"Job\", jobSchema, \"jobs\");\n\nasync function list({\n  from,\n  to\n}) {\n  let data = await Job.find({\n    start: {\n      $gte: from\n    },\n    end: {\n      $lte: to\n    }\n  });\n  return data;\n}\n\nasync function create(data) {\n  let job = new Job(data);\n  await job.save(); //TODO add some validation start must be before end\n\n  return job;\n}\n\nasync function get(id) {\n  const job = await Job.findById(id);\n  return job;\n}\n\nasync function remove(id) {\n  let data = await Job.deleteOne({\n    _id: id\n  });\n  return data;\n}\n\nasync function edit(_id, change) {\n  const product = await get(_id);\n  Object.keys(change).forEach(function (key) {\n    product[key] = change[key];\n  });\n  await product.save();\n  return product;\n}\n\nasync function resetData(data) {\n  await Job.deleteMany();\n  console.log(data);\n  await Job.insertMany(data);\n}\n\nmodule.exports = {\n  list,\n  create,\n  get,\n  remove,\n  resetData,\n  edit,\n  jobSchema,\n  buildSchema\n};\nexports.Job = Job;","map":{"version":3,"sources":["/home/gregorian/calendar-ui/api/model/job.js"],"names":["mongoose","require","cuid","setHours","buildSchema","addressSchema","Schema","_id","type","String","default","value","operativesSchema","chargesSchema","hourlyRate","Number","fuelCharge","travelTime","jobSchema","start","Date","required","end","customer","name","validate","validator","v","length","message","mobile","email","charges","operatives","items","addresses","Job","model","list","from","to","data","find","$gte","$lte","create","job","save","get","id","findById","remove","deleteOne","edit","change","product","Object","keys","forEach","key","resetData","deleteMany","console","log","insertMany","module","exports"],"mappings":"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","sourcesContent":["const mongoose = require(\"mongoose\");\nconst cuid = require(\"cuid\");\n/*const addGcalEvent = require('./../googleCalendar')*/\n\nconst setHours = require(\"date-fns/setHours\");\n\nfunction buildSchema(mongoose) {\n  const addressSchema = new mongoose.Schema({\n    _id: {\n      type: String,\n      default: cuid,\n    },\n    value: {\n      type: String,\n    },\n  });\n\n  const operativesSchema = new mongoose.Schema({\n    _id: {\n      type: String,\n      default: cuid,\n    },\n    value: {\n      type: String,\n    },\n  });\n\n  const chargesSchema = new mongoose.Schema({\n    hourlyRate: { type: Number },\n    fuelCharge: { type: Number },\n    travelTime: { type: Number },\n  });\n\n  const jobSchema = new mongoose.Schema({\n    _id: {\n      type: String,\n      default: cuid,\n    },\n    start: {\n      type: Date,\n      required: true,\n    },\n    end: {\n      type: Date,\n      required: true,\n    },\n    customer: {\n      name: {\n        type: String,\n        validate: [\n          {\n            validator: (v) => {\n              return v.length > 4;\n            },\n            message: `name must have more than 4 characters`,\n          },\n          // this validator was used to look at how multiple validators are handled\n          // \n          // {\n          //   validator: (v) => {\n          //     return v[0] === \"A\";\n          //   },\n          //   message: `first letter must be A`,\n          // },\n        ],\n      },\n      mobile: { type: String },\n      email: { type: String },\n    },\n    charges: chargesSchema,\n    operatives: [operativesSchema],\n    items: String,\n    addresses: [addressSchema],\n  });\n\n  return jobSchema;\n}\n\nconst jobSchema = buildSchema(mongoose);\n\nlet Job = mongoose.model(\"Job\", jobSchema, \"jobs\");\n\nasync function list({ from, to }) {\n  let data = await Job.find({\n    start: { $gte: from },\n    end: { $lte: to },\n  });\n  return data;\n}\n\nasync function create(data) {\n  let job = new Job(data);\n  await job.save(); //TODO add some validation start must be before end\n  return job;\n}\n\nasync function get(id) {\n  const job = await Job.findById(id);\n  return job;\n}\n\nasync function remove(id) {\n  let data = await Job.deleteOne({ _id: id });\n  return data;\n}\n\nasync function edit(_id, change) {\n  const product = await get(_id);\n  Object.keys(change).forEach(function (key) {\n    product[key] = change[key];\n  });\n  await product.save();\n  return product;\n}\n\nasync function resetData(data) {\n  await Job.deleteMany();\n  console.log(data);\n  await Job.insertMany(data);\n}\n\nmodule.exports = {\n  list,\n  create,\n  get,\n  remove,\n  resetData,\n  edit,\n  jobSchema,\n  buildSchema,\n};\n\nexports.Job = Job;\n"]},"metadata":{},"sourceType":"script"}