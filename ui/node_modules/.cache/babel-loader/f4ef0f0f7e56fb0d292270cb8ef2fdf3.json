{"ast":null,"code":"var _jsxFileName = \"/home/gregorian/calendar-ui/ui/src/components/Calendar/Calendar.js\",\n    _s = $RefreshSig$();\n\nimport styled from \"styled-components\";\nimport NewJobModal from \"../forms/NewJobModal\";\nimport DayLabels from \"../DayLabels\";\nimport Week from \"../Week\";\nimport HourTicks from \"../HourTicks\";\nimport Header from \"../Header\";\nimport settingsContext from \"../Contexts\";\nimport { fetchDays } from \"../../Model/Jobs\";\nimport React from \"react\";\nimport { fitsInWeek } from \"../../utilities/dateUtilities.js\";\nimport JobModal from \"../forms/JobModal\"; //import socketIOClient from \"socket.io-client\";\n\nimport { useWeek } from \"./reducer\";\nimport { useGapi } from \"../../useGapi/useGapi\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CalendarStyled = styled.div`\n  margin: 30px;\n  display: grid;\n  grid-template-rows: 60px 60px ${props => String(props.hourHeight * 24) + \"px\"};\n  grid-template-columns: 60px 1fr;\n`;\n_c = CalendarStyled;\nexport default function Calendar() {\n  _s();\n\n  const [daysOnCal, dispatch] = useWeek();\n  const [showNewJobModal, setShowNewJobModal] = React.useState(false);\n  const [displayEvent, setDisplayEvent] = React.useState(null);\n  const [events, setEvents] = React.useState([]);\n  const [gcalEvents, setGcalEvents] = React.useState([]); //TODO have a think about what you are using/nameing current day. what does that mean\n  //useGapi also returns a sign out function\n\n  const {\n    authed,\n    listEvents\n  } = useGapi();\n  const {\n    hourHeight\n  } = React.useContext(settingsContext);\n\n  const updateDisplayEvent = id => {\n    setDisplayEvent(events.filter(event => event._id === id)[0]);\n  };\n\n  React.useEffect(() => {\n    fetchDays(daysOnCal.firstDay, daysOnCal.lastDay).then(data => {\n      setEvents([...data]); //TODO have a look at what we are doing here what if there is no data\n    }).catch(console.error);\n  }, [daysOnCal]);\n  React.useEffect(() => {\n    if (authed) {\n      listEvents(daysOnCal.firstDay, daysOnCal.lastDay) //TODO should technically be a dependancy need to wrap it in useCallback\n      .then(setGcalEvents);\n      console.log(\"aggghhhh\");\n    }\n  }, [authed, daysOnCal]); //added in the listEvebts due to a warning in conslol\n\n  /*  React.useEffect(()=>{\n        const socket = socketIOClient('http://localhost:8000');\n        console.log(socket)\n         socket.on('message',(msg)=>{\n            fetchWeekContaining(firstDayOfWeek)\n                .then(data=> {\n                    setEvents(data)\n                })\n                .catch(console.error)\n        })\n    },[firstDayOfWeek])*/\n\n  const incrementWeek = () => {\n    dispatch({\n      type: \"INCREMENT\"\n    });\n  };\n\n  const decrementWeek = () => {\n    dispatch({\n      type: \"DECREMENT\"\n    });\n  };\n\n  const toggleNewJobModal = () => {\n    setShowNewJobModal(val => !val);\n  };\n\n  const closeDetailsModal = () => {\n    setDisplayEvent(null);\n  };\n\n  const addToEvents = event => {\n    if (fitsInWeek(daysOnCal.firstDay, event.start)) {\n      setEvents(events => [...events, event]);\n    }\n  };\n\n  const updateEvent = (id, data) => {\n    console.log(data);\n    setEvents(events => {\n      console.log(events.length);\n      const remainder = events.filter(event => event._id !== id);\n      const result = [...remainder, data];\n      console.log(\"res\", result);\n      return result;\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(CalendarStyled, {\n      hourHeight: hourHeight,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Header, {\n        currentDate: daysOnCal.currentDate,\n        incrementWeek: incrementWeek,\n        decrementWeek: decrementWeek,\n        handleShowModal: toggleNewJobModal\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DayLabels, {\n        days: daysOnCal.days\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(HourTicks, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Week, {\n        events: events,\n        gcalEvents: gcalEvents,\n        days: daysOnCal.days,\n        updateDisplayEvent: updateDisplayEvent,\n        updateEvent: updateEvent\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), showNewJobModal && /*#__PURE__*/_jsxDEV(NewJobModal, {\n      addToEvents: addToEvents,\n      toggleModal: toggleNewJobModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }, this), displayEvent && /*#__PURE__*/_jsxDEV(JobModal, {\n      displayEvent: displayEvent,\n      close: closeDetailsModal,\n      updateEvent: updateEvent\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Calendar, \"h9zfa0tsilJb64qpuRS0CO8l0os=\", false, function () {\n  return [useWeek, useGapi];\n});\n\n_c2 = Calendar;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"CalendarStyled\");\n$RefreshReg$(_c2, \"Calendar\");","map":{"version":3,"sources":["/home/gregorian/calendar-ui/ui/src/components/Calendar/Calendar.js"],"names":["styled","NewJobModal","DayLabels","Week","HourTicks","Header","settingsContext","fetchDays","React","fitsInWeek","JobModal","useWeek","useGapi","CalendarStyled","div","props","String","hourHeight","Calendar","daysOnCal","dispatch","showNewJobModal","setShowNewJobModal","useState","displayEvent","setDisplayEvent","events","setEvents","gcalEvents","setGcalEvents","authed","listEvents","useContext","updateDisplayEvent","id","filter","event","_id","useEffect","firstDay","lastDay","then","data","catch","console","error","log","incrementWeek","type","decrementWeek","toggleNewJobModal","val","closeDetailsModal","addToEvents","start","updateEvent","length","remainder","result","currentDate","days"],"mappings":"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","sourcesContent":["import styled from \"styled-components\";\nimport NewJobModal from \"../forms/NewJobModal\";\n\nimport DayLabels from \"../DayLabels\";\nimport Week from \"../Week\";\nimport HourTicks from \"../HourTicks\";\n\nimport Header from \"../Header\";\nimport settingsContext from \"../Contexts\";\n\nimport { fetchDays } from \"../../Model/Jobs\";\n\nimport React from \"react\";\nimport { fitsInWeek } from \"../../utilities/dateUtilities.js\";\n\nimport JobModal from \"../forms/JobModal\";\n\n//import socketIOClient from \"socket.io-client\";\n\nimport { useWeek } from \"./reducer\";\nimport { useGapi } from \"../../useGapi/useGapi\";\n\nconst CalendarStyled = styled.div`\n  margin: 30px;\n  display: grid;\n  grid-template-rows: 60px 60px ${(props) =>\n      String(props.hourHeight * 24) + \"px\"};\n  grid-template-columns: 60px 1fr;\n`;\n\nexport default function Calendar() {\n  const [daysOnCal, dispatch] = useWeek();\n  const [showNewJobModal, setShowNewJobModal] = React.useState(false);\n  const [displayEvent, setDisplayEvent] = React.useState(null);\n  const [events, setEvents] = React.useState([]);\n  const [gcalEvents, setGcalEvents] = React.useState([]);\n  //TODO have a think about what you are using/nameing current day. what does that mean\n\n  //useGapi also returns a sign out function\n  const { authed, listEvents } = useGapi();\n\n  const { hourHeight } = React.useContext(settingsContext);\n\n  const updateDisplayEvent = (id) => {\n    setDisplayEvent(events.filter((event) => event._id === id)[0]);\n  };\n\n  React.useEffect(() => {\n    fetchDays(daysOnCal.firstDay, daysOnCal.lastDay)\n      .then((data) => {\n        setEvents([...data]); //TODO have a look at what we are doing here what if there is no data\n      })\n      .catch(console.error);\n  }, [daysOnCal]);\n\n  React.useEffect(() => {\n    if (authed) {\n      listEvents(daysOnCal.firstDay, daysOnCal.lastDay) //TODO should technically be a dependancy need to wrap it in useCallback\n        .then(setGcalEvents);\n\n      console.log(\"aggghhhh\");\n    }\n  }, [authed, daysOnCal]); //added in the listEvebts due to a warning in conslol\n\n  /*  React.useEffect(()=>{\n        const socket = socketIOClient('http://localhost:8000');\n        console.log(socket)\n\n        socket.on('message',(msg)=>{\n            fetchWeekContaining(firstDayOfWeek)\n                .then(data=> {\n                    setEvents(data)\n                })\n                .catch(console.error)\n        })\n    },[firstDayOfWeek])*/\n\n  const incrementWeek = () => {\n    dispatch({ type: \"INCREMENT\" });\n  };\n\n  const decrementWeek = () => {\n    dispatch({ type: \"DECREMENT\" });\n  };\n\n  const toggleNewJobModal = () => {\n    setShowNewJobModal((val) => !val);\n  };\n\n  const closeDetailsModal = () => {\n    setDisplayEvent(null);\n  };\n\n  const addToEvents = (event) => {\n    if (fitsInWeek(daysOnCal.firstDay, event.start)) {\n      setEvents((events) => [...events, event]);\n    }\n  };\n\n  const updateEvent = (id, data) => {\n    console.log(data);\n    setEvents((events) => {\n      console.log(events.length);\n      const remainder = events.filter((event) => event._id !== id);\n     \n      const result = [...remainder, data];\n      console.log(\"res\", result);\n      return result;\n    });\n  };\n\n  return (\n    <React.Fragment>\n      <CalendarStyled hourHeight={hourHeight}>\n        <div></div>\n        <Header\n          currentDate={daysOnCal.currentDate}\n          incrementWeek={incrementWeek}\n          decrementWeek={decrementWeek}\n          handleShowModal={toggleNewJobModal}\n        />\n        <div></div>\n        <DayLabels days={daysOnCal.days} />\n        <HourTicks />\n        <Week\n          events={events}\n          gcalEvents={gcalEvents}\n          days={daysOnCal.days}\n          updateDisplayEvent={updateDisplayEvent}\n          updateEvent={updateEvent}\n        />\n      </CalendarStyled>\n      {showNewJobModal && (\n        <NewJobModal\n          addToEvents={addToEvents}\n          toggleModal={toggleNewJobModal}\n        />\n      )}\n      {displayEvent && (\n        <JobModal\n          displayEvent={displayEvent}\n          close={closeDetailsModal}\n          updateEvent={updateEvent}\n        />\n      )}\n    </React.Fragment>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}